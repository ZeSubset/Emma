<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Interactive Dot-Addition Workbook</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="../css/styles.css">

    <style>
        .num-a {
            background: var(--purple);
        }

        .num-b {
            background: var(--blue)
        }

        .dot.fillA {
            background: var(--purple)
        }

        .dot.fillB {
            background: var(--blue)
        }
    </style>
</head>

<body>
   

    <!-- ───── Settings Panel ───── -->
    <div id="settings">
        <div><label>Color&nbsp;1:</label><input type="color" id="colA" value="#b038a8"></div>
        <div><label>Color&nbsp;2:</label><input type="color" id="colB" value="#0070c0"></div>
        <div><label>Grid&nbsp;Bg:</label><input type="color" id="gridBg" value="#cdecc9"></div>
        <div><label>Panel&nbsp;Bg:</label><input type="color" id="panelBg" value="#f2f2f2"></div>
        <div><label>Font&nbsp;size:</label><input type="range" id="fSize" min="14" max="36" value="20">
            <span id="fsVal">20</span>px
        </div>
    </div>

    <!-- ───── Workbook Grid ───── -->
    <div id="workbook"></div>

    <script>
        // =============== CONFIG ================
        const rows = 1, cols = 1;
        const defaultPairs = [[26, 6]];
        // =======================================

        // ------------- helpers (declare FIRST, so they’re hoisted) -------------
        function makeInput(val, cls) {
            const i = document.createElement('input');
            i.type = 'number'; i.min = 0; i.max = 100; i.value = val;
            i.className = `num-box ${cls}`;
            return i;
        }
        function makeSym(s) {
            const el = document.createElement('div');
            el.className = 'sym';
            el.textContent = s;
            return el;
        }
        function makeAns(inA, inB) {
            const wrap = document.createElement('div'); wrap.className = 'ans-wrap';
            const inp = document.createElement('input');
            inp.type = 'number'; inp.placeholder = ''; inp.className = 'answer-input';

            const badge = document.createElement('div'); badge.className = 'ans-badge';
            wrap.append(inp, badge);

            const validate = () => {
                const sum = (+inA.value || 0) + (+inB.value || 0); // live sum
                const correct = (+inp.value === sum);

                badge.style.display = inp.value === '' ? 'none' : 'flex';
                badge.className = 'ans-badge ' + (correct ? 'ok' : 'fail');
                badge.textContent = correct ? '✓' : '✖';
                inp.style.borderColor =
                    correct ? '#22c55e' :
                        (inp.value === '' ? 'transparent' : '#ef4444');
            };

            inp.addEventListener('input', validate);  // type
            inp.addEventListener('keydown', e => { if (e.key === 'Enter') validate(); });
            inp.addEventListener('blur', validate); // click away

            return { wrap, validate };
        }


        function getVar(name) {
            return getComputedStyle(document.documentElement).getPropertyValue(name);
        }
        function setRootVar(k, v) {
            document.documentElement.style.setProperty(k, v);
        }
        function paint(grid, a, b) {
            grid.innerHTML = '';
            let coloured = 0;
            for (let r = 0; r < 11; r++) {            // 0 … 10 rows
                for (let c = 0; c < 11; c++) {          // 0 … 10 cols
                    const idx = r * 11 + c;                // running index (0..120)
                    const dot = document.createElement('div');

                    // put blank spacer in row 5 or col 5
                    if (r === 5 || c === 5) {
                        dot.className = 'dot spacer';
                    } else {
                        dot.className = 'dot';
                        if (coloured < a) dot.classList.add('fillA');
                        else if (coloured < a + b) dot.classList.add('fillB');
                        coloured++;
                    }
                    grid.appendChild(dot);
                }
            }

        }

        // ------------- makePanel (uses helpers defined above) ------------------
        function makePanel(a, b, idx) {
            const panel = document.createElement('div');
            panel.className = 'panel' + (idx % 2 ? ' alt' : '');
            wb.appendChild(panel);

            const strip = document.createElement('div');
            strip.className = 'eq-strip';
            panel.appendChild(strip);

            const inA = makeInput(a, 'num-a');
            const inB = makeInput(b, 'num-b');
            const ansObj = makeAns(inA, inB);   // {wrap, validate}
            strip.append(inA, makeSym('+'), inB, makeSym('='), ansObj.wrap);

            // strip.append(inA,
            //     makeSym('+'),
            //     inB,
            //     makeSym('='),
            //     makeAns(+inA.value, +inB.value));

            // strip.append(inA, makeSym('+'), inB, makeSym('='), makeAns());

            const wrap = document.createElement('div');
            wrap.className = 'grid-wrap';
            const numCol = document.createElement('div');
            numCol.className = 'num-col';
            const grid = document.createElement('div');
            grid.className = 'grid';
            wrap.append(numCol, grid);          // numbers on left, dots on right
            panel.appendChild(wrap);

            for (let r = 0; r < 11; r++) {

                const cell = document.createElement('div');
                let label = (r < 5) ? (r + 1) : r
                if (r == 5) { label = "" }
                cell.textContent = label;         // 1 at top, 10 at bottom
                numCol.appendChild(cell);
            }

            paint(grid, +inA.value, +inB.value);

            [inA, inB].forEach(inp => inp.addEventListener('input', () => {
                paint(grid, +inA.value || 0, +inB.value || 0);
                ansObj.validate();               // sum has changed → re-validate
            }));

            // [inA, inB].forEach(inp => inp.addEventListener('input', () => {
            //     paint(grid, +inA.value || 0, +inB.value || 0);
            //     ansObj.validate();   // force badge re-check
            // }));

            // [inA, inB].forEach(inp => inp.addEventListener('input', () => {
            //     paint(grid, +inA.value || 0, +inB.value || 0);
            //     // refresh answer validation
            //     answerBox.dispatchEvent(new Event('input'));
            // }));


            // [inA, inB].forEach(inp =>
            //     inp.addEventListener('input', () => paint(grid, +inA.value || 0, +inB.value || 0))
            // );


        }

        // ------------- build the workbook grid ---------------------------------
        const wb = document.getElementById('workbook');
        wb.style.gridTemplateColumns = `repeat(${cols}, minmax(280px, 1fr))`;
        defaultPairs.forEach((pr, idx) => makePanel(pr[0], pr[1], idx));

        // ------------- settings listeners --------------------------------------
        document.getElementById('colA').addEventListener('input', e =>
            setRootVar('--purple', e.target.value));
        document.getElementById('colB').addEventListener('input', e =>
            setRootVar('--blue', e.target.value));
        document.getElementById('gridBg').addEventListener('input', e =>
            setRootVar('--grid-bg', e.target.value));
        document.getElementById('panelBg').addEventListener('input', e =>
            setRootVar('--panel-a', e.target.value));
        document.getElementById('fSize').addEventListener('input', e => {
            setRootVar('--fs', `${e.target.value}px`);
            document.getElementById('fsVal').textContent = e.target.value;
        });
    </script>

</body>

</html>